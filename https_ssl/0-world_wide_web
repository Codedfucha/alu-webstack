#!/usr/bin/env bash
# This script audits subdomains and their DNS records using dig and awk.

# Function to get subdomain information
get_subdomain_info() {
    local subdomain=$1
    local domain=$2
    local full_domain="${subdomain}.${domain}"

    # Use dig to fetch DNS records and awk to parse the output
    local record=$(dig +noall +answer "$full_domain" | awk 'NR==1 {print $4, $5}')

    if [[ -n "$record" ]]; then
        local record_type=$(echo "$record" | awk '{print $1}')
        local destination=$(echo "$record" | awk '{print $2}')
        echo "The subdomain $subdomain is a $record_type record and points to $destination"
    else
        echo "The subdomain $subdomain does not resolve to a record."
    fi
}

# Main script logic
if [[ -z "$1" ]]; then
    echo "Usage: $0 domain [subdomain]"
    exit 1
fi

domain=$1
subdomain=$2

# Predefined subdomains
subdomains=("www" "lb-01" "web-01" "web-02")

if [[ -n "$subdomain" ]]; then
    # Check for a specific subdomain
    get_subdomain_info "$subdomain" "$domain"
else
    # Check for all predefined subdomains
    for sub in "${subdomains[@]}"; do
        get_subdomain_info "$sub" "$domain"
    done
fi

